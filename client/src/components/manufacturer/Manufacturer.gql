
fragment basicManufacturerFields on manufacturer {
    id # Int
    name # String
    url # String
    vendor_id # Int
}

fragment objectManufacturerFields on manufacturer {
	vendor {
		...basicVendorFields
	}
    manufacturer_items {
        ...basicManufacturerItemFields
    }
    # manufacturer_items_aggregate {
    #   aggregate {
    #     count
    #   }
    # }
}

fragment basicManufacturerItemFields on manufacturer_item {
      id
      item_id
      manufacturer_id
      manufacturer_product_id
      # TODO: Series ?
      # the rest of the data is found via `item_id`
      product_url
}

query GetManufacturers {
	manufacturer(order_by: { id: asc }) {
		...basicManufacturerFields
	}
}


query GetManufacturer($id: Int!) {
	manufacturer: manufacturer_by_pk(id: $id) {
		...basicManufacturerFields
		...objectManufacturerFields
	}
}


query GetManufacturerItems {
	manufacturer_item {
		...basicManufacturerItemFields
	}
}

query SearchManufacturers($search_string: String) {
	manufacturer(order_by: { id: asc }, where: { name: { _ilike: $search_string }}) {
        ...basicManufacturerFields
    }
}


mutation InsertManufacturer (
$name: String!
$url: String
$vendor_id: Int
) {
    manufacturer: insert_manufacturer_one(object: {
        name: $name
        url: $url
        vendor_id: $vendor_id
    }) {
        ...basicManufacturerFields
    }
}


mutation InsertManufacturerWithVendor (
$name: String!
$url: String
$vendor: vendor_obj_rel_insert_input
) {
    manufacturer: insert_manufacturer_one(object: {
        name: $name
        url: $url
        vendor: $vendor
    }) {
        ...basicManufacturerFields
    }
}

# mutation UpdateManufacturer (
# $id: Int!
# $name: String!
# $url: String
# $vendor_id: Int
# ) {
#     manufacturer: update_manufacturer_by_pk(
#     pk_columns: {
#         id: $id, 
#     }
#     _set: {
#         name: $name, 
#         url: $url
#         vendor_id: $vendor_id, 
#     }
#     ) {
#         ...basicManufacturerFields
#         ...objectManufacturerFields
#     }
# }

mutation UpdateManufacturerUnchangedVendor (
$id: Int!
$name: String!
$url: String
) {
    manufacturer: update_manufacturer_by_pk(
    pk_columns: {
        id: $id, 
    }
    _set: {
        name: $name, 
        url: $url
    }
    ) {
        ...basicManufacturerFields
        ...objectManufacturerFields
    }
}


mutation DeleteManufacturer (
$id: Int!
) {
    delete_manufacturer_by_pk(id: $id) {
        ...basicManufacturerFields
    }
}


#############################################
## manufacturer specific vendor operations ##
#############################################

mutation InsertVendorWithExistingManufacturer (
$account_id: String
$name: String!
$url: String!
$manufacturer_id: Int!
) {
    insert_vendor_one(
        object: {
            account_id: $account_id
            name: $name
            url: $url
            manufacturer: {
                data: {
                    name: $name
                    url: $url
                    id: $manufacturer_id
                }, 
                on_conflict: {
                    constraint: manufacturer_pkey, 
                    update_columns: vendor_id
                }
            }
        }
    ) {
        id
        name
        url
        manufacturer {
            id
            name
            url
        }
    }
}
